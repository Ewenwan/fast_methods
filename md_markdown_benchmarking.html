<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>n-Dimensional Fast Marching: Benchmarking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">n-Dimensional Fast Marching
   &#160;<span id="projectnumber">0.6</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_markdown_benchmarking.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Benchmarking </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We provide two different ways to perform benchmarks: coding or using configuration (CFG) files.</p>
<dl class="section note"><dt>Note</dt><dd>We acknowledge that it is a bit tedious how we work with the folders. However, we decided with relative paths so that the user has total freedom to set the files as he/she wants.</dd></dl>
<h2>Coding</h2>
<p>Check <a class="el" href="test__fmm__benchmark_8cpp_source.html">test_fmm_benchmark.cpp</a> and <a class="el" href="md_markdown_building.html#building_bmtest">building</a> to find more information about how to use the <a class="el" href="classBenchmark.html" title="This class provides the utilities to benchmark Fast Marching Solvers (configuration, running and logging). It works for FMM (any heap and SFMM), FIM and UFMM. It has not been tested with FM2 solvers. ">Benchmark</a> class.</p>
<dl class="section note"><dt>Note</dt><dd>The benchmark application is currently limited to 3D and to work with FMCell-based <a class="el" href="classnDGridMap.html" title="Templated class which represents a n-dimensional grid map. Its cells are assumed to be cubic...">nDGridMap</a>. However, it is really easy to modify that. Check <a class="el" href="fmm__benchmark_8cpp_source.html">fmm_benchmark.cpp</a> and follow the comments within the code for more instructions.</dd></dl>
<h2>Benchmarking application</h2>
<p>This application allows to configure and run benchmarks very easily. It is implemented in <a class="el" href="fmm__benchmark_8cpp_source.html">fmm_benchmark.cpp</a> and uses <a class="el" href="classBenchmarkCFG.html" title="Configures a Benchmark class from a CFG file. Inspired in the OMPLapp benchmarking software: http://o...">BenchmarkCFG</a> to parse the CFG files and configure a <a class="el" href="classBenchmark.html" title="This class provides the utilities to benchmark Fast Marching Solvers (configuration, running and logging). It works for FMM (any heap and SFMM), FIM and UFMM. It has not been tested with FM2 solvers. ">Benchmark</a> class.</p>
<ul>
<li><a class="el" href="md_markdown_building.html#building_bmapp">Read this to build the application</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This benchmark application has been tested with FMM-based solvers. FM2-based solvers were not tested.</dd></dl>
<p>To run a benchmark once compiled: </p><pre class="fragment">$ ./fmm_benchmark ../benchmark.cfg
</pre><p>It will parse <code>benchmark.cfg</code> and run all the solvers in the environment set with the specified configurations. It will generate a folder called <code>results</code> storing a log and grids (if set to do so). This folder will be generated from the current terminal working directory.</p>
<h3>CFG file</h3>
<p><code>test.cfg</code> provides an example of most of the capabilites implemented: </p><pre class="fragment"># Example configuration file
[grid]
# File: route to image from the current terminal working dir, NOT from this file folder.
file=../../data/img.png
#ndims=2
#cell=FMCell
#dimsize=300,300
</pre><p>Under grid label, we configure the enviroment. If a file is provided (in occupancy format, that is, 8bits grayscale) <code><a class="el" href="classFMCell.html" title="A stand-alone, standard C++ class which represents each one of the cells of a gridmap and its typical...">FMCell</a></code> and 2 dimensions will be assumed. <code>dimsize</code> will be adapted to the size of the image given. A 2D <a class="el" href="classFMCell.html" title="A stand-alone, standard C++ class which represents each one of the cells of a gridmap and its typical...">FMCell</a>, 200x200 grid is given by default. </p><pre class="fragment">[problem]
start=150,150
goal=50,50
</pre><p>Start and goal coordinates. Note the format: <code>s_x, s_y, s_z, ...</code> and <code>g_x, g_y, g_z, ...</code>. If the goal is omitted, the solvers will be rund through all the possible space.</p>
<dl class="section note"><dt>Note</dt><dd>Configuring benchmarks with CFG files allows a unique start and unique goal. If you require multiple starts, you must code the benchmark as done in <a class="el" href="test__fmm__benchmark_8cpp_source.html">test_fmm_benchmark.cpp</a></dd></dl>
<pre class="fragment">[benchmark]
name=test_img
runs=5
#savegrid=1
</pre><p>Set the name of the benchmark and the number of runs for each solver. If <code>savegrid</code> is 1, a <code>.grid</code> file will be saved for every run identified as <code>&lt;runID&gt;.grid</code>, stored in a folder <code>results/&lt;benchmark_name&gt;</code>. By default only the log will be saved. </p><pre class="fragment">[solvers]
fmm=
fmmstar=
fmmstar=FMM*Dist,DISTANCE
fmmfib=
fmmfibstar=
fmmfibstar=FMMFib*Dist,DISTANCE
sfmm=
sfmmstar=
sfmmstar=SFMM*Dist,DISTANCE
gmm=
gmm=myGMM
gmm=myGMM2,1.5
fim=
fim=myFIM
fim=myFIM2,0.01
ufmm=
ufmm=myUFMM
ufmm=myUFMM2,1001
ufmm=myUFMM3,1001,2.01
</pre><p>Specify the solvers to run. The left-hand size must remain unmodified to correctly identify the solver to use. In the right-hand size constructor parameters could be specified for the different solvers, comma-separated. Note the ordering of the parameters. If other parameters are given, the previous parameteres should be also specified.</p>
<h3>Log format</h3>
<p>The benchmark generates a <code>results/&lt;benmchark_name&gt;.log</code> file which stores the important information. The format is as follows:</p>
<p><b>First row:</b> benchmark info. </p><pre class="fragment">name \t #runs \t #dimensions \t size dim(0) \t size dim(1) \t ... \t #start points \t start index 0 \t start index 1 \t ... \t goal index \
</pre><p><b>Following rows:</b> solvers information. </p><pre class="fragment">runID \t solver name \t time (ms) \n
</pre><p>For instance, the first rows generated by the previous CFG are: </p><pre class="fragment">test_img    5       2       400     300     1       60150   20050
0001        FMM     23
0002        FMM     20
0003        FMM     21
0004        FMM     21
0005        FMM     22
0006        FMM*    2
0007        FMM*    0
0008        FMM*    0
0009        FMM*    0
0010        FMM*    0
0011        FMM*Dist        2
...
...
0055        FIM     13
0056        UFMM    15
0057        UFMM    12
0058        UFMM    16
0059        UFMM    12
0060        UFMM    13
</pre><h3>Scripts</h3>
<p>Different scripts are provided to help the user to parse the benchmark results. All of them are in the <code>scripts</code> folder and most of them are for Matlab (they have not been tested in Octave but most will probably work).</p>
<h4>Parse Logs</h4>
<ul>
<li>parseBenchmarkLog.m: provides the function <code>bm = parseBenchmarkLog(file)</code>, where <code>file</code> is the path and filename to the generated log. It returns a cell structure <code>bm</code> with all the information.</li>
</ul>
<pre class="fragment">bm =
name: 'test_img'
nruns: 5
ndims: 2
dimsize: [2x1 double]
startpoints: 60150
goalpoint: 20050
nexp: 60
exp: {12x2 cell}
</pre><p><code>bm.exp</code> divides the different solvers. For instance, for the previous log, <code>bm.exp{1,1}</code> returns the name of the first solver (<a class="el" href="classFMM.html" title="Implements the Fast Marching Method (FMM). ">FMM</a>) and <code>bm.exp{1,2}</code> the times for all runs for first solver ([23 20 21 21 22]).</p>
<h4>Parse Grids</h4>
<ul>
<li>parseGrid.m: Parses a <code>.grid</code> file. Use as `grid = parseGrid('0001.grid')`, gives the result:</li>
</ul>
<pre class="fragment">celltype: 'FMCell - Fast Marching cell'
leafsize: 1
ndims: 2
dimsize: [400 300]
cells: [300x400 double]
</pre><p>Then, you can easily visualize: </p><pre class="fragment">imagesc(grid.cells);
axis image; axis xy;
</pre><div class="image">
<img src="gridplot.png" alt="gridplot.png"/>
<div class="caption">
Example</div></div>
 <h4>Run many experiments</h4>
<p>Every CFG file can run several solvers, with several configurations, several times. However, it only allows to run on one enviroment. To easily solve this, we provide a bash script which executes the benchmark for all the cfg files in a folder.</p>
<ul>
<li>Place .cfg files in the folder: <code>fastmarching/benchmark/cfg/</code></li>
<li>Place the terminal in folder: <code>fastmarching/benchmark/</code></li>
<li><code>Execute run_benchmarks.bash</code>:</li>
</ul>
<pre class="fragment">$ bash ../scripts/run_benchmarks.bash
</pre><p>This will generate the folder <code>fastmarching/benchmark/results</code> with the logs of all the benchmarks. In our case, we executed the following CFG files, modifying only the grid size and start point: </p><pre class="fragment">[grid]
ndims=2
cell=FMCell
dimsize=150,150    | dimsize=300,300    | dimsize=500,500

[problem]
start=75,75        | start=150,150      | start=250,250

[benchmark]
runs=5

[solvers]
fmm=
fmmfib=
sfmm=
gmm=
fim=
ufmm=
</pre><ul>
<li>We provide a Matlab script to process the logs of this kind, so that it is easy to compare solvers with varying enviroment conditions. Execute the Matlab script <code>analyzeBenchmark.m</code> from the <code>benchmark</code> folder. Otherwise, you might need to change the <code>path_to_benchmarks</code> variable in the script. The output could be something like:</li>
</ul>
<div class="image">
<img src="fmmcomp.png" alt="fmmcomp.png"/>
<div class="caption">
Example</div></div>
 <dl class="section note"><dt>Note</dt><dd>This script is under constant development and you may need some modifications depending on your purpose.</dd></dl>
<h2>Adding new solvers to this benchmark</h2>
<p>If you have implemented a custom solver derived from <a class="el" href="classSolver.html" title="Abstract class that serves as interface for the actual solvers implemented. It requires (at least) th...">Solver</a> class, you can easily add it to the benchmarking framework. Just follow this steps ("__mysolver__" is meant to be changed by your solver name):</p>
<dl class="section note"><dt>Note</dt><dd>To help you finding out the places in which you have to add your solver, look for the comment "// Add solver here."</dd></dl>
<ol type="1">
<li>Add its name (lowercase) as known solver in <code><a class="el" href="benchmarkcfg_8hpp_source.html">benchmarkcfg.hpp</a></code> (within <code>readOptions()</code> member function): <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::string&gt; knownSolvers = {</div>
<div class="line">    <span class="stringliteral">&quot;fmm&quot;</span>, <span class="stringliteral">&quot;fmmstar&quot;</span>, <span class="stringliteral">&quot;fmmfib&quot;</span>, <span class="stringliteral">&quot;fmmfibstar&quot;</span>, <span class="stringliteral">&quot;sfmm&quot;</span>, <span class="stringliteral">&quot;sfmmstar&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;gmm&quot;</span>, <span class="stringliteral">&quot;fim&quot;</span>, <span class="stringliteral">&quot;ufmm&quot;</span>, <span class="stringliteral">&quot;fsm&quot;</span>, <span class="stringliteral">&quot;__mysolver__&quot;</span></div>
<div class="line">};</div>
</div><!-- fragment --></li>
<li>In the same file, within <code>configure()</code>, set the creation of the solver without parameters: <div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;ufmm&quot;</span>)</div>
<div class="line">    solver = <span class="keyword">new</span> <a class="code" href="classUFMM.html">UFMM&lt;grid_t&gt;</a>();</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;fsm&quot;</span>)</div>
<div class="line">    solver = <span class="keyword">new</span> <a class="code" href="classFSM.html">FSM&lt;grid_t&gt;</a>();</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;__mysolver__&quot;</span>)</div>
<div class="line">    solver = <span class="keyword">new</span> __MySolver__&lt;grid_t&gt;();</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">continue</span>;</div>
</div><!-- fragment --></li>
<li>Finally, below the previous code, insert your solver creation with constructor parameters (in case it has any): <div class="fragment"><div class="line"><span class="comment">// UFMM</span></div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;ufmm&quot;</span>) {</div>
<div class="line">    <span class="keywordflow">if</span> (p.size() == 1)</div>
<div class="line">        solver = <span class="keyword">new</span> <a class="code" href="classUFMM.html">UFMM&lt;grid_t&gt;</a>(p[0].c_str());</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.size() == 2)</div>
<div class="line">        solver = <span class="keyword">new</span> <a class="code" href="classUFMM.html">UFMM&lt;grid_t&gt;</a>(p[0].c_str(), boost::lexical_cast&lt;<span class="keywordtype">unsigned</span>&gt;(p[1]));</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.size() == 3)</div>
<div class="line">        solver = <span class="keyword">new</span> <a class="code" href="classUFMM.html">UFMM&lt;grid_t&gt;</a>(p[0].c_str(), boost::lexical_cast&lt;<span class="keywordtype">unsigned</span>&gt;(p[1]), boost::lexical_cast&lt;double&gt;(p[2]));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// FSM</span></div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;fsm&quot;</span>) {</div>
<div class="line">    <span class="keywordflow">if</span> (p.size() == 1)</div>
<div class="line">        solver = <span class="keyword">new</span> <a class="code" href="classFSM.html">FSM&lt;grid_t&gt;</a>(p[0].c_str());</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.size() == 2)</div>
<div class="line">        solver = <span class="keyword">new</span> <a class="code" href="classFSM.html">FSM&lt;grid_t&gt;</a>(p[0].c_str(), boost::lexical_cast&lt;<span class="keywordtype">unsigned</span>&gt;(p[1]));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// __MySolver__</span></div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;__mysolver__&quot;</span>) {</div>
<div class="line">    <span class="keywordflow">if</span> (p.size() == 1)</div>
<div class="line">        solver = <span class="keyword">new</span> __MySolver__&lt;grid_t&gt;(p[0].c_str()); <span class="comment">// To change the name</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.size() == 2)</div>
<div class="line">        solver = <span class="keyword">new</span> __MySolver__&lt;grid_t&gt;(p[0].c_str(), boost::lexical_cast&lt;T&gt;(p[1])); <span class="comment">// To change name and first parameter with type T (to be set).</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.size() == 3)</div>
<div class="line">        <span class="comment">//.... In case constructor can have more parameters.</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<p>After these changes, you are ready to incude your solver in a CFG file and run the benchmarks. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Mar 23 2015 19:23:20 for n-Dimensional Fast Marching by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
